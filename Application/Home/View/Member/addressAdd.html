<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/html5.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/respond.min.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__ROOT__/Public/Admin/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__ROOT__/Public/Admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__ROOT__/Public/Admin/lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__ROOT__/Public/Admin/lib/Hui-iconfont/1.0.7/iconfont.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>添加用户</title>
</head>
<body>

<div class="mt-20" style="padding-bottom: 30px;">
  <table class="table table-border table-bordered table-hover table-bg table-sort">
    <thead>
    <tr class="text-c">

      <th width="80">收货人</th>
      <th >电话</th>
      <th>所在地区</th>
      <th>详细地址</th>
      <th>设置默认地址</th>
      <th width="100">操作</th>
    </tr>
    </thead>
    <tbody>
    <Volist name="add_list" id="v" key="k">
      <tr class="text-c" id="tr{$v.id}">

        <td><input  class="input-text" type="text" value="{$v.consignee}" onblur="saveVal(this,{$v['id']},'consignee')" style="text-align: center;"></td>
        <td><input  class="input-text" type="text" value="{$v.tel}" onblur="saveVal(this,{$v['id']},'tel')" style="text-align: center;"></td>
        <td class="text-l">
          {$v.province}
        </td>
        <td><input  class="input-text" type="text" value="{$v.detail_address}" onblur="saveVal(this,{$v['id']},'detail_address')" style="text-align: center;"></td>
        <td><img src="__ROOT__/public/admin/images/icon_{$v['status']?'right':'error'}_s.png" onclick="status(this,{$v.id},'status',{$v.status})"></td>

        <td class="f-14">
          <a title="删除" href="javascript:;" onclick="address_del(this,{$v['id']})" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
        </td>
      </tr>
    </Volist>
    </tbody>
  </table>
</div>

<hr/>
<div class="pd-20">
  <form action="" method="post" class="form form-horizontal" id="form-address-add">
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>收货人姓名：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="member-name" name="consignee" datatype="*2-16" nullmsg="收货人姓名不能为空">
      </div>
      <div class="col-4"> </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>手机：</label>
      <div class="formControls col-3">
        <input type="text" class="input-text"  id="member-tel" name="tel"  datatype="m" nullmsg="手机不能为空">
      </div>

      <div class="col-4"> </div>

    </div>


    <div class="row cl">
      <label class="form-label col-3">所在城市：</label>
      <div class="formControls col-2">
      <div id="city">
        <span class="select-box">
          <select class="prov select" name="prov"  size="1" ></select>
          </span><span class="select-box">
          <select class="city select" disabled="disabled" name="city"> </select>
        </span><span class="select-box">
          <select class="dist select" disabled="disabled" name="dist" ></select>
      </span>
      </div>
      </div>
      <div class="col-4"> </div>
      <label class="form-label col-1"><span class="c-red">*</span>设置为默认：</label>
      <div class="formControls col-1 skin-minimal">
        <div class="check-box">
          <input type="checkbox" id="checkbox-1" name="status" value="1" >
          <label for="checkbox-1">&nbsp;</label>
        </div>
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>请输入详细地址：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" name="detail_address"  datatype="*" nullmsg="详细地址不能为空">
      </div>

      <div class="col-4"> </div>

    </div>

    <div class="row cl">
      <div class="col-9 col-offset-3">
        <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
      </div>
    </div>
  </form>
</div>
</div>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/icheck/jquery.icheck.min.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/Validform/5.3.2/Validform.min.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/lib/layer/2.1/layer.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/js/H-ui.js"></script>
<script type="text/javascript" src="__ROOT__/Public/Admin/js/H-ui.admin.js"></script>
<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
	
	$("#form-member-add").Validform({
		tiptype:2,
		callback:function(form){
			form[0].submit();
			var index = parent.layer.getFrameIndex(window.name);
			parent.$('.btn-refresh').click();
			parent.layer.close(index);
		}
	});
});
</script>
<script type="text/javascript" src="__PUBLIC__js/jquery.cityselect.js"></script>
<script type="text/javascript" src="__PUBLIC__js/city.min.js"></script>
<script type="text/javascript">
    $(function() {
        $("#city").citySelect({
            url: "__PUBLIC__js/city.min.js",
            prov:"{$info['prov']}",
            city:"{$info['city']}",
            dist:"{$info['dist']}",
            nodata: "none"
        });
    });

    // ajax验证
    $("#form-address-add").Validform({
        tiptype:2,
        ajaxPost:true,
        callback:function(form){

            if(form.status=='y'){
                setTimeout(function () {
                    $.Hidemsg();
                    var index = parent.layer.getFrameIndex(window.name);//获取当前页面的索引
                    parent.location.reload();//刷新父窗口
                    parent.layer.close(index);//关闭当前窗口
                },1000)
            }
        }
    });

    // 改变val值
    function saveVal(obj,id,field_name){
        var field_new=$(obj).val();
        $.post("{:U('Public/status')}",{"tableName":'address',"fieldName":field_name,"primary":'id','id':id,"fieldVal":field_new},function(res){
            if (res.status=="y") {
                layer.msg('已修改!',{icon:1,time:1000});
            };
        })
    }
    //设置默认地址
    function status(obj,id,field_name,field_val){
        var field_new=0;
        var imgSrc="__ROOT__/public/admin/images/icon_error_s.png";
        if(field_val==0){
            field_new=1;
            imgSrc="__ROOT__/public/admin/images/icon_right_s.png";
        }
        var status="status(this,"+id+",'"+field_name+"',"+field_new+")";
        $.post("{:U('Public/status')}",{"tableName":'address',"fieldName":field_name,"primary":'id','id':id,"fieldVal":field_new},function(res){
            if(res.status=='y'){
                $(obj).attr('src',imgSrc);
                $(obj).attr('onclick',status);
                setTimeout(function () {
                    var index = parent.layer.getFrameIndex(window.name);//获取当前页面的索引
                    parent.location.reload();//刷新父窗口
                    parent.layer.close(index);//关闭当前窗口
                },1000)
            }else {
                layer.msg('修改失败!请稍后再试',{icon:1,time:1000});
            }
        })
    }

    function address_del(obj,id){
        layer.confirm('确认要删除吗？',function(index){
            //此处请求后台程序，下方是成功后的前台处理……
            $.post("{:U('Public/comDel')}",{"id":id,"tableName":"address"},function (res) {
                if (res.status=="y") {
                    $(obj).parents("tr").remove();
                    layer.msg('已删除!',{icon:1,time:1000});
                };
            });

        });
    }

</script>
</body>
</html>